package org.androidpn.data;

import java.util.ArrayList;
import java.util.HashMap;
import java.util.Iterator;
import java.util.List;
import java.util.Map;

import org.androidpn.client.Constants;

import android.widget.BaseAdapter;

public class SessionManager {
	private final static Map<String,List> sessions= new HashMap<String,List>();//recipient to list of msgs
	private final static Map<String,String> packetMap=new HashMap<String,String>();//packetID to recipient name
	private final static Map<String,BaseAdapter> listeners=new HashMap<String,BaseAdapter>();
	public static void addMsg(String recipient,org.androidpn.data.ChatInfo ci) throws Exception{
		if(recipient==null||ci==null) throw new Exception("add msg exception");
		if(sessions.get(recipient)==null) {
			sessions.put(recipient, new ArrayList<org.androidpn.data.ChatInfo>());
		}
		sessions.get(recipient).add(ci);
		packetMap.put(recipient,ci.getPacketID());
		if(listeners.get(key))
	}
	public static List<?> getMsgList(String recipient){
		if(recipient==null) return null;
		if(sessions.get(recipient)==null) sessions.put(recipient, new ArrayList<Object>());
		return sessions.get(recipient);
	}
	public static void addListener(String recipient,BaseAdapter adapter){
		listeners.put(recipient, adapter);
	}
	public static void removeListener(String recipient){
		listeners.remove(recipient);
	}
	public static void msgSent(String packetID){
		if(packetID==null) return;
		String recipient=packetMap.get(packetID);
		if(recipient==null||sessions.get(recipient)==null) return ;
		List list=sessions.get(recipient);
		Iterator it=list.iterator();
		while(it.hasNext()){
			ChatInfo ci=(ChatInfo) it.next();
			if(ci.getPacketID().equals(packetID)){
				ci.setSent();
				return;
			}
		}
	}
}
